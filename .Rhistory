chisq.test(cups_class_res_01_t[x,],simulate.p.value = T)
})
cups_class_res_01_t_e=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
chisq.test(cups_class_res_01_t[x,],simulate.p.value = T)
})
names(cups_class_res_01_t_e)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
cups_class_res_01_t_e$BRCA$expected
cups_class_res_01_t_e$BRCA$p.value
cups_class_res_01_t_e$BRCA$residuals
cups_class_res_01_t_e$BRCA[[8]]
lapply(cups_class_res_01_t_e,'[',c(3,8))
lapply(cups_class_res_01_t_e,'[[',c(3,8))
lapply(cups_class_res_01_t_e,'[',c(3,8))
cups_class_res_01_t_e=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
chisq.test(cups_class_res_01_t[x,],simulate.p.value = F)
})
names(cups_class_res_01_t_e)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
lapply(cups_class_res_01_t_e,'[',c(3,8))
cups_class_res_01_t_e=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
chisq.test(cups_class_res_01_t[x,],simulate.p.value = T)
})
lapply(cups_class_res_01_t_e,'[',c(3,8))
names(cups_class_res_01_t_e)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
lapply(cups_class_res_01_t_e,'[',c(3,8))
fisher.test(cups_class_res_01_t[1,])
t.test(cups_class_res_01_t[1,])
cups_class_res_01_t_e2=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
t.test(cups_class_res_01_t[x,],mu = mean(cups_class_res_01_t[x,]))
})
names(cups_class_res_01_t_e2)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
cups_class_res_01_t_e2$BRCA$p.value
cups_class_res_01_t_e2$BRCA$statistic
cups_class_res_01_t_e2$BRCA$estimate
lapply(cups_class_res_01_t_e2,'[',3)
mean(cups_class_res_01_t[1,])
mean(cups_class_res_01_t[2,])
mean(cups_class_res_01_t["BRCA",])
\cups_class_res_01_t["BRCA",]
cups_class_res_01_t["BRCA",]
table(cups_class_res_01_t[,3])
head(cups_class_res_01_t)
apply(cups_class_res_01_t,2,sum)
cups_class_res_01_t[1,](apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[1,])
fisher.test(cups_class_res_01_t[1,],(apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[1,]))
cups_class_res_01_t[1,]
(apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[1,])
fisher.test(rbind(cups_class_res_01_t[1,],(apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[1,])))
cups_class_res_01_t_e2=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
fisher.test(rbind(cups_class_res_01_t[x,],(apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[x,])))})
names(cups_class_res_01_t_e2)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
cups_class_res_01_t_e2$BRCA$p.value
cups_class_res_01_t_e2$BRCA$method
cups_class_res_01_t_e2$BRCA$alternative
cups_class_res_01_t_e2=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
fisher.test(rbind(cups_class_res_01_t[x,],(apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[x,])),simulate.p.value = T)})
names(cups_class_res_01_t_e2)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
cups_class_res_01_t_e2$BRCA$p.value
lapply(cups_class_res_01_t_e,'[',1)
lapply(cups_class_res_01_t_e2,'[',1)
cups_class_res_01_t_e2=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
chisq.test(rbind(cups_class_res_01_t[x,],(apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[x,])),simulate.p.value = T)})
names(cups_class_res_01_t_e2)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
lapply(cups_class_res_01_t_e2,'[',3)
cups_class_res_01_t_e2=lapply(rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],function(x){
set.seed(123)
fisher.test(rbind(cups_class_res_01_t[x,],(apply(cups_class_res_01_t,2,sum)-cups_class_res_01_t[x,])),simulate.p.value = T)})
names(cups_class_res_01_t_e2)=rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0]
lapply(cups_class_res_01_t_e2,'[',3)
cups_class_res_01_t_e2$BRCA$data.name2
cups_class_res_01_t_e2$BRCA$data.name1
matrix(c(759, 360, 518, 363), ncol = 2)
odds.ratio(matrix(c(759, 360, 518, 363), ncol = 2))
questionr::odds.ratio(matrix(c(759, 360, 518, 363), ncol = 2))
y1=cups_class_res_01_t[rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],]
y1
x1
x1=1
y1[x1,-1]
cups_class_res_01_t_e2$BRCA$alternative
cups_class_res_01_t_e2$BRCA$data.name1
cups_class_res_01_t_e2$BRCA$data.name2
cups_class_res_01_t_e2$BRCA$method
do.call('rbind',lapply(1:nrow(y),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-1,x2]),sum(y1[-1,-x2]))
t3=rbind(t1,t2)
fisher.test(t3,alternative = 'greater',simulate.p.value = T)$p.value
}))
}))
do.call('rbind',lapply(1:nrow(y),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
fisher.test(t3,alternative = 'greater',simulate.p.value = T)$p.value
}))
}))
x1
x2
x2=1
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
t3
fisher.test(t3,alternative = 'greater',simulate.p.value = T)$p.value
do.call('rbind',lapply(1:nrow(y),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
fisher.test(t3,alternative = 'greater',simulate.p.value = T)$p.value
}))
}))
y1=cups_class_res_01_t[rownames(cups_class_res_01_t)[apply(cups_class_res_01_t,1,sum)>0],]
do.call('rbind',lapply(1:nrow(y1),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
fisher.test(t3,alternative = 'greater',simulate.p.value = T)$p.value
}))
}))
do.call('rbind',lapply(1:nrow(y1),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
fisher.test(t3,alternative = 'greater',simulate.p.value = F)$p.value
}))
}))
do.call('rbind',lapply(1:nrow(y1),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
fisher.test(t3,simulate.p.value = F)$p.value
}))
}))
y1_res=do.call('rbind',lapply(1:nrow(y1),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
fisher.test(t3,alternative = 'gre')$p.value
}))
}))
rownames(y1_res)=rownames(y1)
y1_res
log(y1_res)
-log(y1_res)
questionr::odds.ratio(t3)
t4=questionr::odds.ratio(t3)
t4$OR
y1_res2_p=do.call('rbind',lapply(1:nrow(y1),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
questionr::odds.ratio(t3)$p
}))
}))
rownames(y1_res2_p)=rownames(y1)
y1_res2_or=do.call('rbind',lapply(1:nrow(y1),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
questionr::odds.ratio(t3)$OR
}))
}))
rownames(y1_res2_p)=rownames(y1)
rownames(y1_res2_or)=rownames(y1)
y1_res2_or
y1_res2_p
-log(y1_res)
-(exp(1.3))
-(exp(.05))
-log(0.05)
-log(0.05)
-log10(0.05)
-(exp(2.99))
exp(2.99)
exp(0.05)
exp(2)
log(7.3)
y1_res=-log(y1_res)
y1_res
table(cups_class_res_01$k)
y1_res2=do.call('rbind',lapply(1:nrow(y1),function(x1){
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
chisq.test(t3,correct = T)$p.value
}))
}))
rownames(y1_res2)=rownames(y1)
warnings()
y1_res2=do.call('rbind',lapply(1:nrow(y1),function(x1){
set.seed(123)
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
chisq.test(t3,simulate.p.value = T)$p.value
}))
}))
rownames(y1_res2)=rownames(y1)
lapply(y1_res2,'[',3)
y1_res2
y1_res2=do.call('rbind',lapply(1:nrow(y1),function(x1){
set.seed(123)
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
chisq.test(t3,simulate.p.value = T)$residuals
}))
}))
rownames(y1_res2)=rownames(y1)
y1_res2
(-log(.05))
y1_res[y1_res<(-log(.05))]=0
y1_res
colnames(y1_res)=c('K2','K3','K1','K4')
y1_res=reshape2::melt(y1_res[apply(y1_res,1,sum)!=0,])
y1_res
ggplot(y1_res, aes(x = Var2, y = Var1, fill=colour)) +
geom_raster() +
scale_fill_manual(values=c("grey80", "#B40404", "#0B6121", "#FFBF00")) +
labs(x="letters", y="LETTERS", title="Matrix") +
geom_point(aes(size=value)) +
theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
plot.title=element_text(size=11),
legend.text=element_text(size=7)) +
theme(axis.text.y=element_text(colour=axis.y.colour),axis.text.x=element_text(colour=axis.x.colour))
chisq.test(t3,simulate.p.value = T)$residuals
y1_res2=do.call('rbind',lapply(1:nrow(y1),function(x1){
set.seed(123)
do.call('cbind',lapply(1:4,function(x2){
t1=c(y1[x1,x2],sum(y1[x1,-x2]))
t2=c(sum(y1[-x1,x2]),sum(y1[-x1,-x2]))
t3=rbind(t1,t2)
chisq.test(t3,simulate.p.value = T)$residuals[1,1]
}))
}))
rownames(y1_res2)=rownames(y1)
y1_res2
ggplot(y1_res, aes(x = Var2, y = Var1, fill=colour)) +
geom_raster() +
scale_fill_manual(values=c("grey80", "#B40404", "#0B6121", "#FFBF00")) +
labs(x="letters", y="LETTERS", title="Matrix") +
geom_point(aes(size=value)) +
theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
plot.title=element_text(size=11),
legend.text=element_text(size=7)
) +
theme(axis.text.y=element_text(colour=axis.y.colour),axis.text.x=element_text(colour=axis.x.colour))
ggplot(y1_res, aes(x = Var2, y = Var1, fill=colour)) +
geom_raster() +
scale_fill_manual(values=c("grey80", "#B40404", "#0B6121", "#FFBF00")) +
labs(x="letters", y="LETTERS", title="Matrix") +
geom_point(aes(size=value)) +
theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
plot.title=element_text(size=11),
legend.text=element_text(size=7))
ggplot(y1_res, aes(x = Var2, y = Var1, fill=colour)) +
geom_raster() +
scale_fill_manual(values=c("grey80", "#B40404", "#0B6121", "#FFBF00")) +
labs(x="letters", y="LETTERS", title="Matrix") +
#geom_point(aes(size=value)) +
theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
plot.title=element_text(size=11),
legend.text=element_text(size=7))
ggplot(y1_res, aes(x = Var2, y = Var1, fill=colour)) +
geom_raster() +
scale_fill_manual(values=c("grey80", "#B40404", "#0B6121", "#FFBF00")) +
labs(x="letters", y="LETTERS", title="Matrix") +
#geom_point(aes(size=value)) +
theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
plot.title=element_text(size=11),
legend.text=element_text(size=7))
ggplot(y1_res, aes(x = Var2, y = Var1, fill=value)) +
geom_raster() +
scale_fill_manual(values=c("grey80", "#B40404", "#0B6121", "#FFBF00")) +
labs(x="letters", y="LETTERS", title="Matrix") +
#geom_point(aes(size=value)) +
theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
plot.title=element_text(size=11),
legend.text=element_text(size=7))
ggplot(y1_res, aes(x = Var2, y = Var1, colour=value)) +
geom_raster() +
scale_fill_manual(values=c("grey80", "#B40404", "#0B6121", "#FFBF00")) +
labs(x="letters", y="LETTERS", title="Matrix") +
#geom_point(aes(size=value)) +
theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
plot.title=element_text(size=11),
legend.text=element_text(size=7))
ggplot(y1_res, aes(x = Var2, y = Var1, colour=value)) +
geom_raster()
y1_res
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res),cluster_rows = F< cluster_rows=F)
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res),cluster_rows = F,cluster_rows=F)
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res),cluster_rows = F,cluster_cols=F)
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F)
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::('Blues',9))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal('Blues',9))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 9))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 11))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 3))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 4))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 5))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 6))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 7))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 8))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 10))
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 9))
dev.off()
dev.off()
pdf('/home/enrico/Documenti/ME@MIT/Pdevtum/mouse_tissue_atlas/figs2/figure_paper/supp/cancer_disc/tabeplot_enrich_y1res_fisher.pdf',width = 10,height = 5)
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Blues',n = 9))
dev.off()
pdf('/home/enrico/Documenti/ME@MIT/Pdevtum/mouse_tissue_atlas/figs2/figure_paper/supp/cancer_disc/tabeplot_enrich_y1res_fisher.pdf',width = 10,height = 5)
pheatmap::pheatmap(xtabs(value~Var1+Var2,data = y1_res)[,c(3,1,2,4)],cluster_rows = F,cluster_cols=F,color = RColorBrewer::brewer.pal(name = 'Greens',n = 9))
dev.off()
colnames(cups_sc2)=gsub('_trajectory','', colnames(cups_sc2))
pdf('/home/enrico/Documenti/ME@MIT/Pdevtum/mouse_tissue_atlas/figs2/figure_paper/supp/cancer_disc/hm_cups_ddc.pdf',width = 15,height = 10)
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
dev.off()
cups_sc2=
cups_sc2=scale(cups[,])#-31
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_col =gsub('_trajectory','', colnames(cups_sc2))
,labels_row = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
cups_sc2[1:5,1:5]
View(y1_res2)
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', colnames(cups_sc2))
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
dev.off()
dev.off()
pdf('/home/enrico/Documenti/ME@MIT/Pdevtum/mouse_tissue_atlas/figs2/figure_paper/supp/cancer_disc/hm_cups_ddc.pdf',width = 15,height = 10)
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', colnames(cups_sc2))
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
dev.off()
pdf('/home/enrico/Documenti/ME@MIT/Pdevtum/mouse_tissue_atlas/figs2/figure_paper/supp/cancer_disc/hm_cups_ddc.pdf',width = 15,height = 10)
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)])
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
dev.off()
length(c(46,39,72,5,44,28,10,10,42,67,41,21,64,31,16,47,1,49,9,17,13,23,57,57,74,74,37,30,29,3,32,33,45,34,65,14,75,75,43,67,60,76,77,68,22,18,12,8,38,40,6,6,48,55,56,59,19,19,25))
View(annot_cols)
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)])
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
p=pheatmap::pheatmap(t(cups_sc2[,z3$v1[order(z3$Main_trajectory_refined_by_cluster,z3$v3,z3$v2)]]),cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = F,show_colnames = F, color = my_palette,#rev(brewer.pal(n = 11, name = "PuOr")),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0,gaps_row = c(29,80,98,105,138,154,176,214),breaks = mat_breaks
)#,legend_breaks = c(-2,0,2),legend_labels = c(-2,0,2))
mat_breaks <- quantile_breaks(cups_sc2, n = 11)
cups_sc=scale(cups[,])#-31
cups_sc[is.na(cups_sc)]=0
cups_sc2=scale(cups[,])#-31
quantile_breaks <- function(xs, n = 10) {
breaks <- quantile(xs, probs = seq(0, 1, length.out = n), na.rm=T)
breaks[!duplicated(breaks)]
}
mat_breaks <- quantile_breaks(cups_sc2, n = 11)
my_palette <- c(colorRampPalette(colors = c( "#2D004B","#B4ACC9"))(n = 5),
"white",
c(colorRampPalette(colors = c("#DFB88C", "#7F3B08"))(n= 5)))
p=pheatmap::pheatmap(t(cups_sc2[,z3$v1[order(z3$Main_trajectory_refined_by_cluster,z3$v3,z3$v2)]]),cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = F,show_colnames = F, color = my_palette,#rev(brewer.pal(n = 11, name = "PuOr")),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0,gaps_row = c(29,80,98,105,138,154,176,214),breaks = mat_breaks
)#,legend_breaks = c(-2,0,2),legend_labels = c(-2,0,2))
load('~/Documenti/ME@MIT/Pdevtum/mouse_tissue_atlas/new_res/overall_mean_scores_noz.rsave')
overall_mean_scores_noz=Reduce('cbind', overall_mean_scores_noz)
gc()
overall_mean_scores_noz=parallel::mclapply(overall_mean_scores_noz,'[',2, mc.cores = 15)
gc()
overall_mean_scores_noz=parallel::mclapply(overall_mean_scores_noz,'[',2, mc.cores = 5)
rm(list = ls())
gc()
load('/home/enrico/Documenti/ME@MIT/Pdevtum/mouse_tissue_atlas/figs2/figure_paper/supp/cancer_disc/cups2.rsave')
pheatmap::pheatmap(cups_ddc_pval005_m, cluster_cols = F, cluster_rows = F, clustering_method = 'ward.D',annotation_row = data.frame(Trajectory=gsub('trajectory..|trajectory','',fixed = F,cups_ddc_pval005$Main_trajectory_refined_by_cluster),
Time=cups_ddc_pval005$devtime,row.names = cups_ddc_pval005$traj,stringsAsFactors = T),
annotation_colors  = annot_col,show_rownames = F,show_colnames = F,annotation_col = data.frame(K=as.factor(c(rep_len('1',22),rep_len('2',13),rep_len('3',17))),row.names =  c(rownames(k)[k$k==1],rownames(k)[k$k==2],rownames(k)[k$k==3]),stringsAsFactors = T),
scale = 'row',breaks = mat_breaks, color = viridis::inferno(10))
pheatmap::pheatmap(cups_ddc_pval005_m, cluster_cols = F, cluster_rows = F, clustering_method = 'ward.D',annotation_row = data.frame(Trajectory=gsub('trajectory..|trajectory','',fixed = F,cups_ddc_pval005$Main_trajectory_refined_by_cluster),
Time=cups_ddc_pval005$devtime,row.names = cups_ddc_pval005$traj,stringsAsFactors = T),
annotation_colors  = annot_col,show_rownames = F,show_colnames = F,annotation_col = data.frame(K=as.factor(c(rep_len('1',22),rep_len('2',13),rep_len('3',17))),row.names =  c(rownames(k)[k$k==1],rownames(k)[k$k==2],rownames(k)[k$k==3]),stringsAsFactors = T),
scale = 'row',breaks = mat_breaks, color = viridis::inferno(10))
p=pheatmap::pheatmap(t(cups_sc2[,z3$v1[order(z3$Main_trajectory_refined_by_cluster,z3$v3,z3$v2)]]),cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = F,show_colnames = F, color = my_palette,#rev(brewer.pal(n = 11, name = "PuOr")),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0,gaps_row = c(29,80,98,105,138,154,176,214),breaks = mat_breaks
)#,legend_breaks = c(-2,0,2),legend_labels = c(-2,0,2))
quantile_breaks <- function(xs, n = 10) {
breaks <- quantile(xs, probs = seq(0, 1, length.out = n), na.rm=T)
breaks[!duplicated(breaks)]
}
my_palette <- c(colorRampPalette(colors = c( "#2D004B","#B4ACC9"))(n = 5),
"white",
c(colorRampPalette(colors = c("#DFB88C", "#7F3B08"))(n= 5)))
p=pheatmap::pheatmap(t(cups_sc2[,z3$v1[order(z3$Main_trajectory_refined_by_cluster,z3$v3,z3$v2)]]),cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = F,show_colnames = F, color = my_palette,#rev(brewer.pal(n = 11, name = "PuOr")),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0,gaps_row = c(29,80,98,105,138,154,176,214),breaks = mat_breaks
)#,legend_breaks = c(-2,0,2),legend_labels = c(-2,0,2))
pheatmap::pheatmap(t(cups_sc2[,z3$v1[order(z3$Main_trajectory_refined_by_cluster,z3$v3,z3$v2)]]),cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4)
dev.off()
dev.off()
dev.off()
pheatmap::pheatmap(t(cups_sc2[,z3$v1[order(z3$Main_trajectory_refined_by_cluster,z3$v3,z3$v2)]]),cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4)
apply(cups_sc, 2, summary)
apply(cups_sc, 1, summary)
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)])
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
bk1 <- seq(-7,-0.1,by=0.1)
bk2 <- seq(0.1,3.4,by=0.1)
bk <- c(bk1,bk2)  #combine the break limits for purpose of graphing
my_palette <- c(colorRampPalette(colors = c("darkblue", "lightblue"))(n = length(bk1)-1),
"white", "white",
c(colorRampPalette(colors = c( "tomato1","darkred"))(n = length(bk2)-1)))
rownames(cups_sc2)=gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2)))
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)])
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]))
dim(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]))
pheatmap::pheatmap(cups_ddc_pval005_m, cluster_cols = F, cluster_rows = F, clustering_method = 'ward.D',annotation_row = data.frame(Trajectory=gsub('trajectory..|trajectory','',fixed = F,cups_ddc_pval005$Main_trajectory_refined_by_cluster),
Time=cups_ddc_pval005$devtime,row.names = cups_ddc_pval005$traj,stringsAsFactors = T),
annotation_colors  = annot_col,show_rownames = F,show_colnames = F,annotation_col = data.frame(K=as.factor(c(rep_len('1',22),rep_len('2',13),rep_len('3',17))),row.names =  c(rownames(k)[k$k==1],rownames(k)[k$k==2],rownames(k)[k$k==3]),stringsAsFactors = T),
scale = 'row',breaks = mat_breaks, color = viridis::inferno(10))
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)])
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
annot=data.frame(Main_trajectory=gsub(' trajectory','',z3$Main_trajectory_refined_by_cluster[order(z3$v5)]), row.names = z3$v1[order(z3$v5)],stringsAsFactors = T)
annot_col=list(Main_trajectory=unique(z3[,c(4,7)])[,2])
names(annot_col$Main_trajectory)=gsub(' trajectory','',unique(z3[,c(4,7)])[,1])
bk1 <- seq(-7,-0.1,by=0.1)
bk2 <- seq(0.1,3.4,by=0.1)
bk <- c(bk1,bk2)  #combine the break limits for purpose of graphing
my_palette <- c(colorRampPalette(colors = c("darkblue", "lightblue"))(n = length(bk1)-1),
"white", "white",
c(colorRampPalette(colors = c( "tomato1","darkred"))(n = length(bk2)-1)))
rownames(cups_sc2)=gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2)))
pheatmap::pheatmap(t(cups_sc2[,cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)]]),
cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = T,show_colnames = T,labels_row =gsub('_trajectory','', cups_ddc_pval005$traj[order(cups_ddc_pval005$Main_trajectory_refined_by_cluster,cups_ddc_pval005$traj2,cups_ddc_pval005$traj)])
,labels_col = gsub('^','MGH',gsub('D20-24|-5670F|D22-15','',fixed = F,rownames(cups_sc2))),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0, breaks = bk, color = my_palette,legend_breaks = c(3,1,0,-1,-3,-5,-7),legend_labels = c(3,1,0,-1,-3,-5,-7))
quantile_breaks <- function(xs, n = 10) {
breaks <- quantile(xs, probs = seq(0, 1, length.out = n), na.rm=T)
breaks[!duplicated(breaks)]
}
mat_breaks <- quantile_breaks(cups_sc2, n = 11)
my_palette <- c(colorRampPalette(colors = c( "#2D004B","#B4ACC9"))(n = 5),
"white",
c(colorRampPalette(colors = c("#DFB88C", "#7F3B08"))(n= 5)))
p=pheatmap::pheatmap(t(cups_sc2[,z3$v1[order(z3$Main_trajectory_refined_by_cluster,z3$v3,z3$v2)]]),cluster_cols = hclust(amap::Dist(cups_sc,method = 'spearman'), method = 'ward.D'),cluster_rows = F, cutree_cols = 4,
show_rownames = F,show_colnames = F, color = my_palette,#rev(brewer.pal(n = 11, name = "PuOr")),
annotation_row =  annot,annotation_colors  = annot_col,  treeheight_col = 0,gaps_row = c(29,80,98,105,138,154,176,214),breaks = mat_breaks
)#,legend_breaks = c(-2,0,2),legend_labels = c(-2,0,2))
p
rm(list = ls())
gc()
load('dep_files/data_fis7b.rsave')
setwd('Documenti/ME@MIT/Pdevtum/git/DevTum/')
load('dep_files/data_fis7b.rsave')
load('dep_files/data_fig7b.rsave')
length(nonmalignant_annot$sample
length(nonmalignant_annot$sample)
length(unique(nonmalignant_annot$sample))
length(unique(nonmalignant_annot$tumor))
head(sample())
head(nonmalignant_annot$sample
)
